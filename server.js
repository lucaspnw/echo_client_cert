#!/usr/bin/node

var fs = require('fs');
var https = require('https');
var options = {
            cert: "-----BEGIN CERTIFICATE-----MIIDrjCCApagAwIBAgIEEScEqzANBgkqhkiG9w0BAQsFADCBmDELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAldBMRAwDgYDVQQHEwdTZWF0dGxlMRIwEAYDVQQKEwlNeUNvbXBhbnkxCzAJBgNVBAsTAklUMR4wHAYDVQQDExVsb2NhbGhvc3QubG9jYWxkb21haW4xKTAnBgkqhkiG9w0BCQEWGnJvb3RAbG9jYWxob3N0LmxvY2FsZG9tYWluMB4XDTE5MDIxNDAwMDI1MVoXDTI5MDIxMTAwMDI1MVowgZgxCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJXQTEQMA4GA1UEBxMHU2VhdHRsZTESMBAGA1UEChMJTXlDb21wYW55MQswCQYDVQQLEwJJVDEeMBwGA1UEAxMVbG9jYWxob3N0LmxvY2FsZG9tYWluMSkwJwYJKoZIhvcNAQkBFhpyb290QGxvY2FsaG9zdC5sb2NhbGRvbWFpbjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBANWju621WLgWXcKv9RZsRhCs5i0/o7Go5BHCu+5aSMG/Zp608k+uGtiU4JNHO9CyyNRtFTDgfP1s3RkNsM4emJ70pyl+P84+HeiOVDgVTuO4DZTT+IEiz3nhcpMdNMFjNW9pAw+5arMJ+RsvAEH4ZAJrWdtR7NDkK/vlQJvWfHiNEnAhIHYXr8CrjqfJ7VitBt/xR+ke+2UVGIEp5blY3FCUC0TNzqay01wjIyJKzXs9iTQzUR7tDlVXOP73aXr9S49e9Kyy2XFalC30sc6M1l9xl6is5Ae85Z6jF/EqSAgiVwc6hmEvEkO+bSdU0ffytwkt6WneQVTaG2b4Ogd1s90CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAle3w+joZsVLHVVuDaSEg1INrTRVpRd6sUkWAlzKi8ABFjlZHCuYFeasRGAavQvU/fRoqC+hv6BQDeV3sh1DVjBTEYKEFwkAqfRHCc+b6qGUR359jdutPTqjoXM5wyLCLHdws/zgBQQfkOxcbcGMB7hj127mJBCQzKOL6FyWdY1iaFik+LyLyr//EV3tAo+5Rrs4Gzzuy3knBUtdqa/EoW83tsLSZ6goQQ37Yn1/G+ukzJ9F366PX6HR6NoYXagE+wBX++e8zfvpOjIBVH+GM7VE6GUyTnVot5Ly5HeMQUew4qdiNIxsv3l1lZt94Kdt2X6qoXcbixLt7+SHZsrcSbg==-----END CERTIFICATE-----",
            key: "-----BEGIN PRIVATE KEY-----MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDVo7uttVi4Fl3Cr/UWbEYQrOYtP6OxqOQRwrvuWkjBv2aetPJPrhrYlOCTRzvQssjUbRUw4Hz9bN0ZDbDOHpie9Kcpfj/OPh3ojlQ4FU7juA2U0/iBIs954XKTHTTBYzVvaQMPuWqzCfkbLwBB+GQCa1nbUezQ5Cv75UCb1nx4jRJwISB2F6/Aq46nye1YrQbf8UfpHvtlFRiBKeW5WNxQlAtEzc6mstNcIyMiSs17PYk0M1Ee7Q5VVzj+92l6/UuPXvSsstlxWpQt9LHOjNZfcZeorOQHvOWeoxfxKkgIIlcHOoZhLxJDvm0nVNH38rcJLelp3kFU2htm+DoHdbPdAgMBAAECggEAEWAvAkaS1+wXxZ8eiauWOkJ5uRnpNCimngwu0Ui+DKYG0GcqoxDnxZA8QLZFNujnnSFfHRnRCKKbS++ZXvZNlvYSh3UpdtqF/7Vdw671+t7sGdvwpP4iDkloEm+IbCcnwC80DMoZk8S+ojedJ4Buj+TPyt77qhS4wBTJ/7K+7mXy2eqe6oeZ3AqeA/7fiu4hhr4iKyukAzyErZadxtp2sqq0ronmhajxtLaK8HurAeNKxbJsfIPhKJHHt8MJhri7sX/wuOBKhTjCGFOi2IO/EEnDRsA+ZW2Sp3sMU4I+wqG99IhJt1mFHSQfzoESr1kHzQ99jnZMWLE46fmjiy7n6QKBgQDvYHeDloXkBk4tUPD2KUDX7QA2F5fDgkc4WuOOSaKB3uum1axGFYQBv55x2ozK6mMveqh4n3To+Ys3YlK+7gy+3xGNTd1ktxK/rjYT9ULkEkNK+ysXGXSKfbJaFxcRpndhsSBDbeUIG5DHO7nLBvRoupN3UKIZ8lON5l5Mv6fSdQKBgQDkebihJw7aekjq6976rTwoYBCqBBAEQAAnGvxx/0efcQzQSvAoctrfaW3Jto+m1IJ52xq3UEzss0U6AahKXM2pVotG43Mo/LzVorWv6XhD+JaZySJQclMP7Td+67W2pURLeRRCFEjy5Eqozs6EC6aEGAF4vZ3ylCvGcRkIDXDeyQKBgQDR3i+qLKQCgQy1akt4Zj61kNIompKyFFxAql7rdt+FIV5VjOxXHbH4nnlZtJTPqqN/Evj1mEe1omNOEWQehTKjfYsz6dp63I8Rgrli0hrtPp3E9WSYAfdNHFrr5WaSUPJFsjdpJsYwT4qlQlXoDJbn4vw7FXSpbu2WcSyn+Tg3qQKBgQCEoRRImH/K3AnQNbRvGHk/huSljU4u6WgtS0EYe/R73ghuMdJP6LydzHnrCotBcUN8sXBE0dyV20tobOXgpRbOImsfb5G+TVjhO171CzbBXmEuTNAamwMUz8PTbclCiZWnqlXUNipStauRatv/UzQKolTYXlp+Iv12aNj7D7Jh4QKBgQDgdVZUSgVq2EC09elU8xiIrdrqNDet2J6OPLC/Lc58K7ufnw0mw+oakYlDq7IpRrOOIJwgzvAAxg0C+M7bEIPst5vwSWP0q42isSLowYu7w5ppP0p8Df5XqWLu3xKWwVbN2+kWpi1zvy54g2buQHTgnNioNk4oCAMekkdT+VJMHQ==-----END PRIVATE KEY-----",
            ca: "-----BEGIN CERTIFICATE-----MIIDrjCCApagAwIBAgIEEScEqzANBgkqhkiG9w0BAQsFADCBmDELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAldBMRAwDgYDVQQHEwdTZWF0dGxlMRIwEAYDVQQKEwlNeUNvbXBhbnkxCzAJBgNVBAsTAklUMR4wHAYDVQQDExVsb2NhbGhvc3QubG9jYWxkb21haW4xKTAnBgkqhkiG9w0BCQEWGnJvb3RAbG9jYWxob3N0LmxvY2FsZG9tYWluMB4XDTE5MDIxNDAwMDI1MVoXDTI5MDIxMTAwMDI1MVowgZgxCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJXQTEQMA4GA1UEBxMHU2VhdHRsZTESMBAGA1UEChMJTXlDb21wYW55MQswCQYDVQQLEwJJVDEeMBwGA1UEAxMVbG9jYWxob3N0LmxvY2FsZG9tYWluMSkwJwYJKoZIhvcNAQkBFhpyb290QGxvY2FsaG9zdC5sb2NhbGRvbWFpbjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBANWju621WLgWXcKv9RZsRhCs5i0/o7Go5BHCu+5aSMG/Zp608k+uGtiU4JNHO9CyyNRtFTDgfP1s3RkNsM4emJ70pyl+P84+HeiOVDgVTuO4DZTT+IEiz3nhcpMdNMFjNW9pAw+5arMJ+RsvAEH4ZAJrWdtR7NDkK/vlQJvWfHiNEnAhIHYXr8CrjqfJ7VitBt/xR+ke+2UVGIEp5blY3FCUC0TNzqay01wjIyJKzXs9iTQzUR7tDlVXOP73aXr9S49e9Kyy2XFalC30sc6M1l9xl6is5Ae85Z6jF/EqSAgiVwc6hmEvEkO+bSdU0ffytwkt6WneQVTaG2b4Ogd1s90CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAle3w+joZsVLHVVuDaSEg1INrTRVpRd6sUkWAlzKi8ABFjlZHCuYFeasRGAavQvU/fRoqC+hv6BQDeV3sh1DVjBTEYKEFwkAqfRHCc+b6qGUR359jdutPTqjoXM5wyLCLHdws/zgBQQfkOxcbcGMB7hj127mJBCQzKOL6FyWdY1iaFik+LyLyr//EV3tAo+5Rrs4Gzzuy3knBUtdqa/EoW83tsLSZ6goQQ37Yn1/G+ukzJ9F366PX6HR6NoYXagE+wBX++e8zfvpOjIBVH+GM7VE6GUyTnVot5Ly5HeMQUew4qdiNIxsv3l1lZt94Kdt2X6qoXcbixLt7+SHZsrcSbg==-----END CERTIFICATE-----",
            requestCert: true,
            rejectUnauthorized: false
};
https.createServer(options, function (req, res) {
            console.log(new Date()+' '+
                            req.connection.remoteAddress+' '+
                            req.method+' '+req.url);
            res.writeHead(200);
            var certstr = JSON.stringify(req.connection.getPeerCertificate(), null, 2);
            if(certstr == '{}') { certstr = 'No cert provided by client'; }
            res.write('<html>Your cert:<br><pre>' + certstr + '</pre></html>');
            res.end("hello world\n");
}).listen(4433);
